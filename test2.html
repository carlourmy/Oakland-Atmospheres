<!DOCTYPE html>
<html>

<head>
    <title></title>
    <meta charset="UTF-8">
    <script type="text/javascript" src="d3.min.js"></script>
    <script type="text/javascript" src="jquery-1.11.3.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <ul class="nav">
        <li id="search">
            <input type="button" name="search_button" id="search_button">
            </a>
            <input type="text" name="search_text" id="search_text" placeholder="MM/DD/YYYY" />
        </li>
        <li>
            <a href="#">Option 1</a>
        </li>
        <li>
            <a href="#">Option 2</a>
        </li>
        <li id="options">
            <a href="#">Tell Me About:</a>
            <ul class="subnav">
                <li><a href="#">Story1</a></li>
                <li><a href="#">Story2</a></li>
                <li><a href="#">Story3</a></li>
                <li><a href="#">Story4</a></li>
            </ul>
        </li>
    </ul>
    <script type="text/javascript">
    //Beginning Variables
    var vv = window;
    visWidth = vv.innerWidth * .95;
    visHeight = (vv.innerHeight * .95) - 50;


    //Create Master Container

    var vis = d3.select("body")
        .append("svg")
        .attr("width", visWidth)
        .attr("height", visHeight)
        .attr("y", 50);


    //Add Height References

    vis.append("svg:image")
        .attr("xlink:href", "737.svg")
        .attr("x", "5")
        .attr("y", (.95 * visHeight - (3218 * 3.75) * (visHeight) / 35000) - 25)
        .attr("width", "50")
        .attr("height", "50");

    vis.append("svg:image")
        .attr("xlink:href", "sr71.svg")
        .attr("x", "5")
        .attr("y", (.95 * visHeight - (3218 * 8.05) * (visHeight) / 35000) - 25)
        .attr("width", "50")
        .attr("height", "50");

    vis.append("svg:image")
        .attr("xlink:href", "mountain.svg")
        .attr("x", "5")
        .attr("y", (.95 * visHeight - (3218 * 2.05) * (visHeight) / 35000))
        .attr("width", "50")
        .attr("height", "50");

    vis.append("svg:image")
        .attr("xlink:href", "helmet.svg")
        .attr("x", "2")
        .attr("y", (.95 * visHeight - (3218 * 6) * (visHeight) / 35000) - 20)
        .attr("width", "55")
        .attr("height", "55");

    //Add Vertical Scale Text

    for (i = 0; i <= 11; i++) {
        vis.append("text")
            .text(+(i * 2) + " Miles")
            .attr("width", 100)
            .attr("x", (visWidth / 2))
            .attr("y", .95 * visHeight - (3218 * i) * (visHeight) / 35000)
            .attr("font-size", "10px")
            .attr("fill", "gray")
            .attr("text-anchor", "middle")
            .attr("alignment-baseline", "middle");

        atms = [1, .63, .40, .25, .16, .10, .06, .04, .03, .02, .01]

        vis.append("text")
            .text(+(atms[i]) + " atm")
            .attr("width", 100)
            .attr("text-align", "center")
            .attr("x", (visWidth) - 40)
            .attr("y", .95 * visHeight - (3218 * i) * (visHeight / 35000) + 3)
            .attr("font-size", "10px")
            .attr("fill", "gray");

        //Add Vertical Scale Lines

        vis.append("svg:line")
            .attr("x1", 10)
            .attr("y1", .95 * visHeight - (3218 * i) * (visHeight / 35000))
            .attr("x2", (visWidth / 2) - 25)
            .attr("y2", .95 * visHeight - (3218 * i) * (visHeight / 35000))
            .attr("stroke", "silver")
            .attr("stroke-width", 1)
            .attr("stroke-dasharray", ("3,3"));

        vis.append("svg:line")
            .attr("x1", (visWidth / 2) + 25)
            .attr("y1", .95 * visHeight - (3218 * i) * (visHeight / 35000))
            .attr("x2", visWidth - 50)
            .attr("y2", .95 * visHeight - (3218 * i) * (visHeight / 35000))
            .attr("stroke", "silver")
            .attr("stroke-width", 1)
            .attr("stroke-dasharray", ("3,3"));
    };

    //Add Horizontal Mile Lines

    for (i = 0; i <= 10; i++) {
        vis.append("svg:line")
            .attr("x1", (visWidth / 4) + (i * (3219 * ((visWidth / 4) / 35000))))
            .attr("y1", (.95 * visHeight) + 20)
            .attr("x2", (visWidth / 4) + (i * (3219 * ((visWidth / 4) / 35000))))
            .attr("y2", (.95 * visHeight) + 10)
            .attr("stroke", "silver")
            .attr("stroke-width", 1);
    };

    for (i = 1; i <= 10; i++) {
        vis.append("svg:line")
            .attr("x1", (visWidth / 4) - (i * (3219 * ((visWidth / 4) / 35000))))
            .attr("y1", (.95 * visHeight) + 20)
            .attr("x2", (visWidth / 4) - (i * (3219 * ((visWidth / 4) / 35000))))
            .attr("y2", (.95 * visHeight) + 10)
            .attr("stroke", "silver")
            .attr("stroke-width", 1);
    };
    //Add Horizontal Mile Text

    for (i = 0; i <= 10; i += 2) {
        vis.append("text")
            .text(i * 2)
            .attr("x", (visWidth / 4) + (i * (3219 * ((visWidth / 4) / 35000))))
            .attr("y", visHeight - 1)
            .attr("font-size", "10px")
            .attr("fill", "gray")
            .attr("text-anchor", "middle");
    };

    for (i = 2; i <= 10; i += 2) {
        vis.append("text")
            .text(i * 2)
            .attr("x", (visWidth / 4) - (i * (3219 * ((visWidth / 4) / 35000))))
            .attr("y", visHeight - 1)
            .attr("font-size", "10px")
            .attr("fill", "gray")
            .attr("text-anchor", "middle");
    };

    //Add East West

    vis.append("text")
        .text("West")
        .attr("x", visWidth / 4 - 80)
        .attr("y", (visHeight * .95) - 10)
        .attr("fill", "gray")
        .attr("font-size", "15px");

    vis.append("text")
        .text("East")
        .attr("x", (visWidth / 4) + 50)
        .attr("y", (visHeight * .95) - 10)
        .attr("fill", "gray")
        .attr("font-size", "15px");

    //Create TMP Scale Marks

    var TMPWidth = visWidth / 4;
    var TMPHeight = visHeight * .95;

    for (i = 1; i <= 5; i++) {
        vis.append("svg:line")
            .attr("x1", ((.5 * visWidth) + TMPWidth - 5) - (i * (.95 * TMPWidth) / 6))
            .attr("y1", TMPHeight + 10)
            .attr("x2", ((.5 * visWidth) + TMPWidth - 5) - (i * (.95 * TMPWidth) / 6))
            .attr("y2", TMPHeight + 20)
            .attr("stroke", "silver")
            .attr("stroke-width", 1);
    };


    for (i = 1; i <= 5; i++) {
        vis.append("text")
            .text(-120 + (i * 40) + "F")
            .attr("x", ((.5 * visWidth) + TMPWidth - 5) - (i * (.95 * TMPWidth) / 6))
            .attr("y", visHeight - 1)
            .attr("font-size", "10px")
            .attr("fill", "gray")
            .attr("text-anchor", "middle");
    };

    //Create Humidity Scale Marks

    var rhWidth = visWidth / 4.5;
    var rhHeight = visHeight * .95;

    for (i = 1; i <= 5; i++) {
        vis.append("svg:line")
            .attr("x1", (.75 * visWidth) + (i * (.95 * rhWidth) / 5))
            .attr("y1", rhHeight + 10)
            .attr("x2", (.75 * visWidth) + (i * (.95 * rhWidth) / 5))
            .attr("y2", rhHeight + 20)
            .attr("stroke", "silver")
            .attr("stroke-width", 1);
    };

    for (i = 1; i <= 5; i++) {
        vis.append("text")
            .text((i * 20) + "%")
            .attr("x", ((.5 * visWidth) + TMPWidth) + (i * (.95 * rhWidth) / 5))
            .attr("y", visHeight - 1)
            .attr("font-size", "10px")
            .attr("fill", "gray")
            .attr("text-anchor", "middle");
    };


    //Load the Data

    d3.json("min.json", function(error, data) {
        launch2 = d3.nest()
            .key(function(d) {
                return d.D
            })
            .key(function(d) {
                return d.T
            })
            .entries(data);


        var startDate = "07/11/2015"

        if (startDate != null) {

            var thisDay = launch2.filter(function(d) {
                return d.key === startDate
            });

            launch1 = thisDay[0].values[0].values;
            initChart();
        };


        $("#search_text").change(function() {

            var searchDate = $("#search_text").val();

            startDate = null;

            var thisDay = launch2.filter(function(d) {
                return d.key === searchDate
            });
            launch1 = thisDay[0].values[0].values;

            svgContainer.remove();
            TMPSvg.remove();
            rhSvg.remove();

            initChart();
        });


        function initChart() {

            //Create Container for Flight Path

            svgContainer = vis.append('svg')
                .data(launch1)
                .append("svg")
                .attr("width", visWidth / 2)
                .attr("height", visHeight * .95);

            //Create Running Total

            var xPos = [{
                x: 0,
                y: 0
            }];
            var totalWind = 0;
            var totalHeight = 0;

            for (i = 1; i < launch1.length; i++) {
                totalWind = Math.floor(totalWind + (launch1[i - 1].W) * ((launch1[i].GPH - launch1[i - 1].GPH) / 50));

                totalHeight = launch1[i].GPH;

                xPos.push({
                    "x": totalWind,
                    "y": totalHeight
                });
            }

            //Create Line Function

            var lineGen1 = d3.svg.line()
                .x(function(d) {
                    return (visWidth / 4) + (d.x) * ((visWidth / 12) / 35000)
                })
                .y(function(d) {
                    return visHeight - (d.y) * ((visHeight) / 35000)
                })
                .interpolate("basis");

            // Add Clipping Mask

            svgContainer.append('clipPath')
                .attr("id", "mask")
                .append("rect")
                .attr("x", 0)
                .attr("y", visHeight)
                .attr("width", visWidth)
                .attr("height", visHeight * 2)
                .transition()
                .duration(50 * launch1.length)
                .ease("linear")
                .attr("y", visHeight - (launch1[launch1.length - 1].GPH * (visHeight / 35000)));

            //Add Line

            var flightPath = svgContainer.append('svg:path')
                .attr('stroke', 'black')
                .attr('stroke-width', 2.5)
                .style("stroke-dasharray", ("3, 3"))
                .attr('fill', 'none')
                .attr('d', lineGen1(xPos))
                .attr("clip-path", "url(#mask)");

            //Add Text of D

            svgContainer.append("text")
                .attr("x", 10)
                .attr("y", .95 * visHeight - (3218 * 10) * ((visHeight) / 35000) + 20)
                .text(function(d) {
                    return launch1[0].D
                })
                .attr("font-size", "20px")
                .attr("fill", "black")
                .transition()
                .duration(100 * (launch1[0].D.length))
                .ease("linear")
                .tween("text", function() {
                    var newText = launch1[0].D;
                    var textLength = launch1[0].D.length;
                    return function(t) {
                        this.textContent = newText.slice(0, Math.round(t * textLength));
                    };
                })

            svgContainer.append("text")
                .attr("x", 10)
                .attr("y", .95 * visHeight - (3218 * 10) * ((visHeight) / 35000) + 45)
                .attr("font-size", "20px")
                .attr("fill", "black")
                .transition()
                .delay(100 * (launch1[0].D.length))
                .duration(100 * (launch1[0].T.length))
                .ease("linear")
                .tween("text", function() {
                    var newText = launch1[0].T;
                    var textLength = launch1[0].T.length;
                    return function(t) {
                        this.textContent = newText.slice(0, Math.round(t * textLength));
                    };
                })

            //Create TMP Container
            var TMPWidth = visWidth / 4;
            var TMPHeight = visHeight * .95;

            TMPSvg = vis.append('svg')
                .attr("x", visWidth / 2)
                .append("svg")
                .attr("width", TMPWidth)
                .attr("height", TMPHeight);

            //Create TMP Bars Scale

            horTMPScale = d3.scale.linear()
                .domain([1887.06, 3220.39])
                .range([0, TMPWidth * .95]);


            //Create TMP Bars
            var lastRec = launch1.length - 1;

            TMPSvg.selectAll("rect")
                .data(launch1)
                .enter()
                .append("rect")
                .attr("y", function(d, i) {
                    return (TMPHeight - (i * (TMPHeight / launch1.length)) / (35000 / (launch1[lastRec].GPH)) - (TMPHeight / launch1.length));
                })
                .attr("x", TMPWidth - 5)
                .attr("height", function(d, i) {
                    return ((TMPHeight / (35000 / (launch1[lastRec].GPH))) / (launch1.length - 1)) - 1;
                })
                .attr("width", 0)
                .attr("fill", function(d) {
                    if (d.TMP > 2731.5) {
                        return d3.rgb(123, 156, 184);
                    } else {
                        return d3.rgb(63, 96, 124);
                    }
                })
                .transition()
                .delay(function(d, i) {
                    return i * 50
                })
                .duration(1500)
                .ease("linear")
                .attr("x", function(d, i) {
                    return TMPWidth - (horTMPScale(d.TMP)) - 5;
                })
                .attr("width", function(d) {
                    return (horTMPScale(d.TMP));
                })
                .attr("fill", function(d) {
                    if (d.TMP > 2731.5) {
                        return d3.rgb(123, 156, 184);
                    } else {
                        return d3.rgb(63, 96, 124);
                    };
                });

            //Create TMP Caps

            TMPSvg.selectAll("rect.cap")
                .data(launch1)
                .enter()
                .append("rect")
                .attr("class", "cap")
                .attr("y", function(d, i) {
                    return (TMPHeight - (i * (TMPHeight / launch1.length)) / (35000 / (launch1[lastRec].GPH)) - (TMPHeight / launch1.length));
                })
                .attr("x", function(d) {
                    return (TMPWidth - 5);
                })
                .attr("fill", "orangered")
                .attr("height", function(d, i) {
                    return ((TMPHeight / (35000 / (launch1[lastRec].GPH))) / (launch1.length + 1)) - .5
                })

            .transition()
                .delay(function(d, i) {
                    return i * 50
                })
                .duration(1500)
                .ease("linear")

            .attr("x", function(d) {
                    return (TMPWidth - horTMPScale(d.TMP) - 5);
                })
                .attr("height", function(d, i) {
                    return ((TMPHeight / (35000 / (launch1[lastRec].GPH))) / (launch1.length + 1)) - .5;
                })
                .attr("width", 2)
                .attr("fill", "orangered");

            //Create Humidity Container

            rhSvg = vis.append('svg')
                .attr("x", visWidth * .75)
                .append("svg")
                .attr("width", rhWidth)
                .attr("height", rhHeight)
                .style("background-color", function(d) {
                    return d3.rgb(255, 250, 238)
                });

            //Create Humidity Scale

            var horRhScale = d3.scale.linear()
                .domain([0, 1000])
                .range([0, rhWidth * .95]);

            //Create Humidity Bars

            var lastRec = launch1.length - 1

            rhSvg.selectAll("rect")
                .data(launch1)
                .enter()
                .append("rect")
                .attr("y", function(d, i) {
                    return (rhHeight - (i * (rhHeight / launch1.length)) / (35000 / (launch1[lastRec].GPH)) - (rhHeight / launch1.length));
                })
                .attr("x", 5)
                .attr("height", function(d, i) {
                    return ((rhHeight / (35000 / (launch1[lastRec].GPH))) / (launch1.length - 1)) - .5;
                })
                .attr("fill", function(d) {
                    if (d.RH < 1000) {
                        return d3.rgb(0, 128, 128);
                    } else {
                        return d3.rgb(0, 178, 178);
                    };
                })
                .attr("width", 0)
                .transition()
                .delay(function(d, i) {
                    return i * 50
                })
                .duration(1500)
                .ease("linear")

            .attr("width", function(d) {
                if (d.RH === "N") {
                    return 0;
                } else {
                    return horRhScale(d.RH)
                }
            });

            //Create Humidity Caps

            rhSvg.selectAll("rect.cap")
                .data(launch1)
                .enter()
                .append("rect")
                .attr("class", "cap")
                .attr("y", function(d, i) {
                    return (rhHeight - (i * (rhHeight / launch1.length)) / (35000 / (launch1[lastRec].GPH)) - (rhHeight / launch1.length));
                })
                .attr("height", function(d, i) {
                    return ((rhHeight / (35000 / (launch1[lastRec].GPH))) / (launch1.length - 1)) - .5;
                })
                .attr("x", 5)
                .attr("fill", function(d) {
                    if (d.RH === "N") {
                        return d3.rgb(248, 131, 121);
                    } else {
                        return "coral";
                    }
                })
                .attr("opacity", function(d) {
                    if (d.RH === "N") {
                        return .5;
                    } else {
                        return 1;
                    }
                })
                .transition()
                .delay(function(d, i) {
                    return i * 50
                })
                .duration(1500)
                .ease("linear")

            .attr("height", function(d, i) {
                    return ((rhHeight / (35000 / (launch1[lastRec].GPH))) / (launch1.length - 1)) - .5;
                })
                .attr("width", 2)
                .attr("x", function(d) {
                    if (d.RH === "N") {
                        return 5;
                    } else {
                        return horRhScale(d.RH) + 5
                    }
                });
        };
    });
    </script>
</body>

</html>
